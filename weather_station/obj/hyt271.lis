                        .module hyt271.c
                        .area text(rom, con, rel)
 0000                   .dbfile ./hyt271.c
 0000                   .dbfile C:\Users\ADMINI~1\WEATHE~1\WEATHE~1\hyt271.c
 0000                   .dbfunc e measuring _measuring fV
 0000           ;      capdata07 -> X+8
 0000           ;       tempdata -> X+6
 0000           ;     capdata813 -> X+4
 0000           ;        humdata -> X+2
 0000           ;              i -> X+0
 0000           ;       humidity -> X-7
 0000           ;    temperature -> X-5
 0000           _measuring::
 0000                   .dbline -1
 0000 10                push X
 0001 4F                mov X,SP
 0002 380A              add SP,10
 0004                   .dbline 8
 0004           ; 
 0004           ; 
 0004           ; #include "PSoCAPI.h"
 0004           ; #include <stdio.h>
 0004           ; #include <stdlib.h>
 0004           ; 
 0004           ; 
 0004           ;       void measuring (int*temperature, int*humidity) {
 0004                   .dbline 16
 0004           ;       
 0004           ;       
 0004           ;               //get temp and humidity here
 0004           ;               
 0004           ; 
 0004           ;               int capdata07, capdata813, tempdata, humdata, i;
 0004           ;               
 0004           ;               I2Cm_Start();                           //Initialize I2C
 0004 10                push X
 0005 7C0000            xcall _I2Cm_Start
 0008                   .dbline 17
 0008           ;               I2Cm_fSendStart( 0x28, 0);      //Send Measuring Request
 0008 5700              mov X,0
 000A 5028              mov A,40
 000C 7C0000            xcall _I2Cm_fSendStart
 000F                   .dbline 18
 000F           ;               I2Cm_fSendStart( 0x28, 1);      //Send Data Fetch
 000F 5701              mov X,1
 0011 5028              mov A,40
 0013 7C0000            xcall _I2Cm_fSendStart
 0016                   .dbline 20
 0016           ;               
 0016           ;               capdata813=I2Cm_bRead (I2Cm_ACKslave);
 0016 5001              mov A,1
 0018 7C0000            xcall _I2Cm_bRead
 001B 20                pop X
 001C 5405              mov [X+5],A
 001E 560400            mov [X+4],0
 0021                   .dbline 21
 0021           ;               capdata07 =I2Cm_bRead (I2Cm_ACKslave);
 0021 10                push X
 0022 5001              mov A,1
 0024 7C0000            xcall _I2Cm_bRead
 0027 20                pop X
 0028 5409              mov [X+9],A
 002A 560800            mov [X+8],0
 002D                   .dbline 22
 002D           ;               tempdata  =I2Cm_bRead (I2Cm_NAKslave);
 002D 10                push X
 002E 5000              mov A,0
 0030 7C0000            xcall _I2Cm_bRead
 0033 20                pop X
 0034 5407              mov [X+7],A
 0036 560600            mov [X+6],0
 0039                   .dbline 24
 0039           ;               
 0039           ;               I2Cm_SendStop();                        //Stop I2C      
 0039 10                push X
 003A 7C0000            xcall _I2Cm_SendStop
 003D 20                pop X
 003E                   .dbline 27
 003E           ;               
 003E           ;               // calculating temp and humidity
 003E           ;               capdata813=capdata813<<8;
 003E 5205              mov A,[X+5]
 0040 5404              mov [X+4],A
 0042 560500            mov [X+5],0
 0045                   .dbline 28
 0045           ;               humdata=capdata813|capdata07;
 0045 5205              mov A,[X+5]
 0047 2B09              or A,[X+9]
 0049 5403              mov [X+3],A
 004B 5204              mov A,[X+4]
 004D 2B08              or A,[X+8]
 004F 5402              mov [X+2],A
 0051                   .dbline 29
 0051           ;               humdata=humdata&0x3FFF;
 0051 27023F            and [X+2],63
 0054                   .dbline 31
 0054           ;               
 0054           ;               humdata=100/2^14*humdata;
 0054 5202              mov A,[X+2]
 0056 08                push A
 0057 5203              mov A,[X+3]
 0059 08                push A
 005A 5000              mov A,0
 005C 08                push A
 005D 500E              mov A,14
 005F 08                push A
 0060 7C0000            xcall __mul16
 0063 38FC              add SP,-4
 0065 5F0000            mov [__r1],[__rX]
 0068 5F0000            mov [__r0],[__rY]
 006B 5100              mov A,[__r1]
 006D 3132              xor A,50
 006F 5403              mov [X+3],A
 0071 5100              mov A,[__r0]
 0073 3100              xor A,0
 0075 5402              mov [X+2],A
 0077                   .dbline 32
 0077           ;               tempdata=165/2^14*tempdata-40;
 0077 5206              mov A,[X+6]
 0079 08                push A
 007A 5207              mov A,[X+7]
 007C 08                push A
 007D 5000              mov A,0
 007F 08                push A
 0080 500E              mov A,14
 0082 08                push A
 0083 7C0000            xcall __mul16
 0086 38FC              add SP,-4
 0088 5F0000            mov [__r1],[__rX]
 008B 5F0000            mov [__r0],[__rY]
 008E 160028            sub [__r1],40
 0091 1E0000            sbb [__r0],0
 0094 5100              mov A,[__r1]
 0096 3152              xor A,82
 0098 5407              mov [X+7],A
 009A 5100              mov A,[__r0]
 009C 3100              xor A,0
 009E 5406              mov [X+6],A
 00A0                   .dbline 38
 00A0           ;               
 00A0           ;               
 00A0           ;               
 00A0           ;               
 00A0           ;               //FIR filter
 00A0           ;               for(i=0; i<4; i++) temperature[i] = temperature[i+1];
 00A0 560100            mov [X+1],0
 00A3 560000            mov [X+0],0
 00A6           L2:
 00A6                   .dbline 38
 00A6 5201              mov A,[X+1]
 00A8 0101              add A,1
 00AA 64                asl A
 00AB 5300              mov [__r1],A
 00AD 52FC              mov A,[X-4]
 00AF 0400              add [__r1],A
 00B1 3E00              mvi A,[__r1]
 00B3 5300              mov [__r0],A
 00B5 3E00              mvi A,[__r1]
 00B7 5300              mov [__r1],A
 00B9 5201              mov A,[X+1]
 00BB 64                asl A
 00BC 5300              mov [__r3],A
 00BE 52FC              mov A,[X-4]
 00C0 0400              add [__r3],A
 00C2 5100              mov A,[__r0]
 00C4 3F00              mvi [__r3],A
 00C6 5100              mov A,[__r1]
 00C8 3F00              mvi [__r3],A
 00CA           L3:
 00CA                   .dbline 38
 00CA 7701              inc [X+1]
 00CC 0F0000            adc [X+0],0
 00CF                   .dbline 38
 00CF 5201              mov A,[X+1]
 00D1 1104              sub A,4
 00D3 5200              mov A,[X+0]
 00D5 3180              xor A,-128
 00D7 1980              sbb A,(0 ^ 0x80)
 00D9 CFCC              jc L2
 00DB           X0:
 00DB                   .dbline 39
 00DB           ;               temperature[4] = tempdata;
 00DB 52FC              mov A,[X-4]
 00DD 0108              add A,8
 00DF 5300              mov [__r1],A
 00E1 5206              mov A,[X+6]
 00E3 3F00              mvi [__r1],A
 00E5 5207              mov A,[X+7]
 00E7 3F00              mvi [__r1],A
 00E9                   .dbline 42
 00E9           ;               
 00E9           ;               
 00E9           ;               for(i=0; i<4; i++) humidity[i] = humidity[i+1];
 00E9 560100            mov [X+1],0
 00EC 560000            mov [X+0],0
 00EF           L6:
 00EF                   .dbline 42
 00EF 5201              mov A,[X+1]
 00F1 0101              add A,1
 00F3 64                asl A
 00F4 5300              mov [__r1],A
 00F6 52FA              mov A,[X-6]
 00F8 0400              add [__r1],A
 00FA 3E00              mvi A,[__r1]
 00FC 5300              mov [__r0],A
 00FE 3E00              mvi A,[__r1]
 0100 5300              mov [__r1],A
 0102 5201              mov A,[X+1]
 0104 64                asl A
 0105 5300              mov [__r3],A
 0107 52FA              mov A,[X-6]
 0109 0400              add [__r3],A
 010B 5100              mov A,[__r0]
 010D 3F00              mvi [__r3],A
 010F 5100              mov A,[__r1]
 0111 3F00              mvi [__r3],A
 0113           L7:
 0113                   .dbline 42
 0113 7701              inc [X+1]
 0115 0F0000            adc [X+0],0
 0118                   .dbline 42
 0118 5201              mov A,[X+1]
 011A 1104              sub A,4
 011C 5200              mov A,[X+0]
 011E 3180              xor A,-128
 0120 1980              sbb A,(0 ^ 0x80)
 0122 CFCC              jc L6
 0124           X1:
 0124                   .dbline 43
 0124           ;               humidity[4] = humdata;
 0124 52FA              mov A,[X-6]
 0126 0108              add A,8
 0128 5300              mov [__r1],A
 012A 5202              mov A,[X+2]
 012C 3F00              mvi [__r1],A
 012E 5203              mov A,[X+3]
 0130 3F00              mvi [__r1],A
 0132                   .dbline -2
 0132           L1:
 0132 38F6              add SP,-10
 0134 20                pop X
 0135                   .dbline 0 ; func end
 0135 7F                ret
 0136                   .dbsym l capdata07 8 I
 0136                   .dbsym l tempdata 6 I
 0136                   .dbsym l capdata813 4 I
 0136                   .dbsym l humdata 2 I
 0136                   .dbsym l i 0 I
 0136                   .dbsym l humidity -7 pI
 0136                   .dbsym l temperature -5 pI
 0136                   .dbend
 0136                   .dbfunc e printtemp _printtemp fV
 0136           ;         result -> X+2
 0136           ;              i -> X+0
 0136           ;    temperature -> X-9
 0136           ;     secondLine -> X-7
 0136           ;      firstLine -> X-5
 0136           _printtemp::
 0136                   .dbline -1
 0136 10                push X
 0137 4F                mov X,SP
 0138 3804              add SP,4
 013A                   .dbline 49
 013A           ;               
 013A           ;               }
 013A           ;               
 013A           ;               
 013A           ;               
 013A           ;               void printtemp (char *firstLine, char *secondLine, int*temperature) {
 013A                   .dbline 52
 013A           ;                                       //calculate the average of temperature
 013A           ;                                       int result, i;
 013A           ;                                       result = 0;
 013A 560300            mov [X+3],0
 013D 560200            mov [X+2],0
 0140                   .dbline 53
 0140           ;                                       for(i=0; i<5; i++) result = result + temperature [i]; 
 0140 560100            mov [X+1],0
 0143 560000            mov [X+0],0
 0146           L11:
 0146                   .dbline 53
 0146 5201              mov A,[X+1]
 0148 64                asl A
 0149 5300              mov [__r1],A
 014B 52F8              mov A,[X-8]
 014D 0400              add [__r1],A
 014F 3E00              mvi A,[__r1]
 0151 5300              mov [__r0],A
 0153 3E00              mvi A,[__r1]
 0155 0503              add [X+3],A
 0157 5100              mov A,[__r0]
 0159 0D02              adc [X+2],A
 015B           L12:
 015B                   .dbline 53
 015B 7701              inc [X+1]
 015D 0F0000            adc [X+0],0
 0160                   .dbline 53
 0160 5201              mov A,[X+1]
 0162 1105              sub A,5
 0164 5200              mov A,[X+0]
 0166 3180              xor A,-128
 0168 1980              sbb A,(0 ^ 0x80)
 016A CFDB              jc L11
 016C           X2:
 016C                   .dbline 54
 016C           ;                                       result = result/5;
 016C 5000              mov A,0
 016E 08                push A
 016F 5005              mov A,5
 0171 08                push A
 0172 5202              mov A,[X+2]
 0174 08                push A
 0175 5203              mov A,[X+3]
 0177 08                push A
 0178 7C0000            xcall __divmod_16X16_16
 017B 18                pop A
 017C 5403              mov [X+3],A
 017E 18                pop A
 017F 5402              mov [X+2],A
 0181 38FE              add SP,-2
 0183                   .dbline 57
 0183           ;                                       
 0183           ;                                       //send to LCD
 0183           ;                                       csprintf(firstLine, "Temperature:    ");
 0183 5033              mov A,>L15
 0185 08                push A
 0186 5033              mov A,<L15
 0188 08                push A
 0189 52FB              mov A,[X-5]
 018B 08                push A
 018C 52FC              mov A,[X-4]
 018E 08                push A
 018F 7C0000            xcall _csprintf
 0192                   .dbline 58
 0192           ;                                       csprintf(secondLine,"%i C            ",result);
 0192 5202              mov A,[X+2]
 0194 08                push A
 0195 5203              mov A,[X+3]
 0197 08                push A
 0198 5022              mov A,>L16
 019A 08                push A
 019B 5022              mov A,<L16
 019D 08                push A
 019E 52F9              mov A,[X-7]
 01A0 08                push A
 01A1 52FA              mov A,[X-6]
 01A3 08                push A
 01A4 7C0000            xcall _csprintf
 01A7 38F6              add SP,-10
 01A9                   .dbline -2
 01A9           L10:
 01A9 38FC              add SP,-4
 01AB 20                pop X
 01AC                   .dbline 0 ; func end
 01AC 7F                ret
 01AD                   .dbsym l result 2 I
 01AD                   .dbsym l i 0 I
 01AD                   .dbsym l temperature -9 pI
 01AD                   .dbsym l secondLine -7 pc
 01AD                   .dbsym l firstLine -5 pc
 01AD                   .dbend
 01AD                   .dbfunc e printhum _printhum fV
 01AD           ;         result -> X+2
 01AD           ;              i -> X+0
 01AD           ;       humidity -> X-9
 01AD           ;     secondLine -> X-7
 01AD           ;      firstLine -> X-5
 01AD           _printhum::
 01AD                   .dbline -1
 01AD 10                push X
 01AE 4F                mov X,SP
 01AF 3804              add SP,4
 01B1                   .dbline 64
 01B1           ;                                       }
 01B1           ;                                       
 01B1           ;                                       
 01B1           ;                                       
 01B1           ;                                       
 01B1           ;               void printhum (char *firstLine, char *secondLine, int*humidity) {
 01B1                   .dbline 67
 01B1           ;                                       //calculate the average of humidity
 01B1           ;                                       int result, i;
 01B1           ;                                       result = 0;
 01B1 560300            mov [X+3],0
 01B4 560200            mov [X+2],0
 01B7                   .dbline 68
 01B7           ;                                       for(i=0; i<5; i++) result = result + humidity [i];
 01B7 560100            mov [X+1],0
 01BA 560000            mov [X+0],0
 01BD           L18:
 01BD                   .dbline 68
 01BD 5201              mov A,[X+1]
 01BF 64                asl A
 01C0 5300              mov [__r1],A
 01C2 52F8              mov A,[X-8]
 01C4 0400              add [__r1],A
 01C6 3E00              mvi A,[__r1]
 01C8 5300              mov [__r0],A
 01CA 3E00              mvi A,[__r1]
 01CC 0503              add [X+3],A
 01CE 5100              mov A,[__r0]
 01D0 0D02              adc [X+2],A
 01D2           L19:
 01D2                   .dbline 68
 01D2 7701              inc [X+1]
 01D4 0F0000            adc [X+0],0
 01D7                   .dbline 68
 01D7 5201              mov A,[X+1]
 01D9 1105              sub A,5
 01DB 5200              mov A,[X+0]
 01DD 3180              xor A,-128
 01DF 1980              sbb A,(0 ^ 0x80)
 01E1 CFDB              jc L18
 01E3           X3:
 01E3                   .dbline 69
 01E3           ;                                       result = result/5;
 01E3 5000              mov A,0
 01E5 08                push A
 01E6 5005              mov A,5
 01E8 08                push A
 01E9 5202              mov A,[X+2]
 01EB 08                push A
 01EC 5203              mov A,[X+3]
 01EE 08                push A
 01EF 7C0000            xcall __divmod_16X16_16
 01F2 18                pop A
 01F3 5403              mov [X+3],A
 01F5 18                pop A
 01F6 5402              mov [X+2],A
 01F8 38FE              add SP,-2
 01FA                   .dbline 72
 01FA           ;                                       
 01FA           ;                                       //send to LCD
 01FA           ;                                       csprintf(firstLine, "Humidity:       ");
 01FA 5011              mov A,>L22
 01FC 08                push A
 01FD 5011              mov A,<L22
 01FF 08                push A
 0200 52FB              mov A,[X-5]
 0202 08                push A
 0203 52FC              mov A,[X-4]
 0205 08                push A
 0206 7C0000            xcall _csprintf
 0209                   .dbline 73
 0209           ;                                       csprintf(secondLine,"%i  %           ",result);
 0209 5202              mov A,[X+2]
 020B 08                push A
 020C 5203              mov A,[X+3]
 020E 08                push A
 020F 5000              mov A,>L23
 0211 08                push A
 0212 5000              mov A,<L23
 0214 08                push A
 0215 52F9              mov A,[X-7]
 0217 08                push A
 0218 52FA              mov A,[X-6]
 021A 08                push A
 021B 7C0000            xcall _csprintf
 021E 38F6              add SP,-10
 0220                   .dbline -2
 0220           L17:
 0220 38FC              add SP,-4
 0222 20                pop X
 0223                   .dbline 0 ; func end
 0223 7F                ret
 0224                   .dbsym l result 2 I
 0224                   .dbsym l i 0 I
 0224                   .dbsym l humidity -9 pI
 0224                   .dbsym l secondLine -7 pc
 0224                   .dbsym l firstLine -5 pc
 0224                   .dbend
                        .area lit(rom, con, rel, lit)
 0000           L23:
 0000 25692020252020202020202020202020  .byte 37,'i,32,32,37,32,32,32,32,32,32,32,32,32,32,32
 0010 00                .byte 0
 0011           L22:
 0011 48756D69646974793A20202020202020  .byte 'H,'u,'m,'i,'d,'i,'t,'y,58,32,32,32,32,32,32,32
 0021 00                .byte 0
 0022           L16:
 0022 25692043202020202020202020202020  .byte 37,'i,32,'C,32,32,32,32,32,32,32,32,32,32,32,32
 0032 00                .byte 0
 0033           L15:
 0033 54656D70657261747572653A20202020  .byte 'T,'e,'m,'p,'e,'r,'a,'t,'u,'r,'e,58,32,32,32,32
 0043 00                .byte 0
