                        .module main.c
                        .area text(rom, con, rel)
 0000                   .dbfile ./main.c
 0000                   .dbfile C:\Users\ADMINI~1\WEATHE~1\WEATHE~1\main.c
 0000                   .dbfunc e main _main fV
 0000           ;       humidity -> X+44
 0000           ;    temperature -> X+34
 0000           ;  lcdSecondLine -> X+18
 0000           ;   lcdFirstLine -> X+2
 0000           ;    displaymode -> X+0
 0000           _main::
 0000                   .dbline -1
 0000 10                push X
 0001 4F                mov X,SP
 0002 3836              add SP,54
 0004                   .dbline 34
 0004           ; //----------------------------------------------------------------------------
 0004           ; // Ports:
 0004           ; // P0_0 = MCLK
 0004           ; // P0_1 = XCLR adc reset
 0004           ; // P0_2 = Button SW
 0004           ; // P0_3 = windspeed input
 0004           ; // P0_4 = rainsensor input
 0004           ; // P0_5 = sunlight (solar) input
 0004           ; // P0_6 = I2C SDA
 0004           ; // P0_7 = I2C SCL
 0004           ; // P1_0 = Gray Code
 0004           ; // P1_1 = Gray Code
 0004           ; // P1_1 = Gray Code
 0004           ; // P2   = LCD
 0004           ; //----------------------------------------------------------------------------
 0004           ; 
 0004           ; #define LCD_LENGTH 16         // 16 plus \0 termination?
 0004           ; 
 0004           ; #include <m8c.h>        // part specific constants and macros
 0004           ; #include "PSoCAPI.h"    // PSoC API definitions for all User Modules
 0004           ; #include <stdio.h>
 0004           ; #include <HYT271.h>           //include C-Code from the humidity and temperature Sensor
 0004           ; /*
 0004           ; typedef enum {
 0004           ;       overview = 0,
 0004           ;       temp = 1,
 0004           ;       humidity = 2,
 0004           ;       rain = 3,
 0004           ;       wind = 4,
 0004           ; } MODE;
 0004           ; */
 0004           ; 
 0004           ; void main(void)
 0004           ; {
 0004                   .dbline 38
 0004           ; 
 0004           ;       //Variables
 0004           ;       char lcdFirstLine[LCD_LENGTH], lcdSecondLine[LCD_LENGTH];
 0004           ;       int displaymode = 1;
 0004 560101            mov [X+1],1
 0007 560000            mov [X+0],0
 000A                   .dbline 47
 000A           ;       int temperature[5];
 000A           ;       int humidity[5];
 000A           ;       
 000A           ;       
 000A           ;       
 000A           ;       /** init **/
 000A           ;       
 000A           ;       // interrupt and SleepTimer init
 000A           ;       M8C_EnableGInt ;                            // Turn on interrupts
 000A 7101                      or  F, 01h
 000C           
 000C                   .dbline 48
 000C           ;       SleepTimer_Start();
 000C 10                push X
 000D 7C0000            xcall _SleepTimer_Start
 0010                   .dbline 49
 0010           ;     SleepTimer_SetInterval(SleepTimer_8_HZ);    // Set interrupt to a
 0010 5010              mov A,16
 0012 7C0000            xcall _SleepTimer_SetInterval
 0015                   .dbline 50
 0015           ;     SleepTimer_EnableInt();                     // 8 Hz rate
 0015 7C0000            xcall _SleepTimer_EnableInt
 0018                   .dbline 53
 0018           ; 
 0018           ;       // LCD init
 0018           ;       LCD_Init();
 0018 7C0000            xcall _LCD_Init
 001B 20                pop X
 001C                   .dbline 56
 001C           ;       
 001C           ;       // print welcome screen to LCD
 001C           ;       csprintf(lcdFirstLine,"   Welcome to   ");
 001C 5033              mov A,>L2
 001E 08                push A
 001F 5033              mov A,<L2
 0021 08                push A
 0022 5A00              mov [__r1],X
 0024 060002            add [__r1],2
 0027 5100              mov A,[__r0]
 0029 08                push A
 002A 5100              mov A,[__r1]
 002C 08                push A
 002D 7C0000            xcall _csprintf
 0030                   .dbline 57
 0030           ;       csprintf(lcdSecondLine, " Weatherstation ");
 0030 5022              mov A,>L3
 0032 08                push A
 0033 5022              mov A,<L3
 0035 08                push A
 0036 5A00              mov [__r1],X
 0038 060012            add [__r1],18
 003B 5100              mov A,[__r0]
 003D 08                push A
 003E 5100              mov A,[__r1]
 0040 08                push A
 0041 7C0000            xcall _csprintf
 0044 38F8              add SP,-8
 0046                   .dbline 58
 0046           ;       LCD_Position(0,0);
 0046 10                push X
 0047 5000              mov A,0
 0049 5700              mov X,0
 004B 7C0000            xcall _LCD_Position
 004E 20                pop X
 004F                   .dbline 59
 004F           ;       LCD_PrString(lcdFirstLine);
 004F 5A00              mov [__r1],X
 0051 060002            add [__r1],2
 0054 10                push X
 0055 5100              mov A,[__r0]
 0057 08                push A
 0058 5100              mov A,[__r1]
 005A 5C                mov X,A
 005B 18                pop A
 005C 7C0000            xcall _LCD_PrString
 005F                   .dbline 60
 005F           ;       LCD_Position(1,0);
 005F 5700              mov X,0
 0061 5001              mov A,1
 0063 7C0000            xcall _LCD_Position
 0066 20                pop X
 0067                   .dbline 61
 0067           ;       LCD_PrString(lcdSecondLine);
 0067 5A00              mov [__r1],X
 0069 060012            add [__r1],18
 006C 10                push X
 006D 5100              mov A,[__r0]
 006F 08                push A
 0070 5100              mov A,[__r1]
 0072 5C                mov X,A
 0073 18                pop A
 0074 7C0000            xcall _LCD_PrString
 0077 20                pop X
 0078 811B              xjmp L5
 007A           L4:
 007A                   .dbline 64
 007A           ; 
 007A           ; 
 007A           ;       while(1) {
 007A                   .dbline 66
 007A           ;       
 007A           ;               I2Cm_Start();                           //Initialize I2C
 007A 10                push X
 007B 7C0000            xcall _I2Cm_Start
 007E                   .dbline 67
 007E           ;               I2Cm_fSendStart( 0x28, 0);      //Send Measuring Request        
 007E 5700              mov X,0
 0080 5028              mov A,40
 0082 7C0000            xcall _I2Cm_fSendStart
 0085 20                pop X
 0086                   .dbline 71
 0086           ;               //measuring(temperature, humidity);
 0086           ;       
 0086           ;               
 0086           ;               displaymode =1;
 0086 560101            mov [X+1],1
 0089 560000            mov [X+0],0
 008C                   .dbline 72
 008C           ;               switch(displaymode) {
 008C 3D0000            cmp [X+0],0
 008F B006              jnz X1
 0091 3D0100            cmp [X+1],0
 0094 A0AB              jz L8
 0096           X1:
 0096 3D0000            cmp [X+0],0
 0099 B006              jnz X2
 009B 3D0101            cmp [X+1],1
 009E A021              jz L10
 00A0           X2:
 00A0 3D0000            cmp [X+0],0
 00A3 B006              jnz X3
 00A5 3D0102            cmp [X+1],2
 00A8 A03F              jz L11
 00AA           X3:
 00AA 3D0000            cmp [X+0],0
 00AD B006              jnz X4
 00AF 3D0103            cmp [X+1],3
 00B2 A08D              jz L8
 00B4           X4:
 00B4 3D0000            cmp [X+0],0
 00B7 B006              jnz X5
 00B9 3D0104            cmp [X+1],4
 00BC A083              jz L8
 00BE           X5:
 00BE 8051              xjmp L7
 00C0           L10:
 00C0                   .dbline 78
 00C0           ;                       case 0:
 00C0           ;                               // overview();
 00C0           ;                               break;
 00C0           ;                               
 00C0           ;                       case 1:
 00C0           ;                               printtemp(lcdFirstLine, lcdSecondLine, temperature);
 00C0 5A00              mov [__r1],X
 00C2 060022            add [__r1],34
 00C5 5100              mov A,[__r0]
 00C7 08                push A
 00C8 5100              mov A,[__r1]
 00CA 08                push A
 00CB 5A00              mov [__r1],X
 00CD 060012            add [__r1],18
 00D0 5100              mov A,[__r0]
 00D2 08                push A
 00D3 5100              mov A,[__r1]
 00D5 08                push A
 00D6 5A00              mov [__r1],X
 00D8 060002            add [__r1],2
 00DB 5100              mov A,[__r0]
 00DD 08                push A
 00DE 5100              mov A,[__r1]
 00E0 08                push A
 00E1 7C0000            xcall _printtemp
 00E4 38FA              add SP,-6
 00E6                   .dbline 79
 00E6           ;                               break;
 00E6 8059              xjmp L8
 00E8           L11:
 00E8                   .dbline 82
 00E8           ;                               
 00E8           ;                       case 2:
 00E8           ;                               printhum(lcdFirstLine, lcdSecondLine, humidity);
 00E8 5A00              mov [__r1],X
 00EA 06002C            add [__r1],44
 00ED 5100              mov A,[__r0]
 00EF 08                push A
 00F0 5100              mov A,[__r1]
 00F2 08                push A
 00F3 5A00              mov [__r1],X
 00F5 060012            add [__r1],18
 00F8 5100              mov A,[__r0]
 00FA 08                push A
 00FB 5100              mov A,[__r1]
 00FD 08                push A
 00FE 5A00              mov [__r1],X
 0100 060002            add [__r1],2
 0103 5100              mov A,[__r0]
 0105 08                push A
 0106 5100              mov A,[__r1]
 0108 08                push A
 0109 7C0000            xcall _printhum
 010C 38FA              add SP,-6
 010E                   .dbline 83
 010E           ;                               break;
 010E 8031              xjmp L8
 0110           L7:
 0110                   .dbline 94
 0110           ;                               
 0110           ;                       case 3:
 0110           ;                               // rain();
 0110           ;                               break;
 0110           ;                               
 0110           ;                       case 4:
 0110           ;                               // wind();
 0110           ;                               break;
 0110           ;               
 0110           ;                       default:
 0110           ;                               displaymode = 0;
 0110 560100            mov [X+1],0
 0113 560000            mov [X+0],0
 0116                   .dbline 95
 0116           ;                               csprintf(lcdFirstLine,"     Error      ");
 0116 5011              mov A,>L14
 0118 08                push A
 0119 5011              mov A,<L14
 011B 08                push A
 011C 5A00              mov [__r1],X
 011E 060002            add [__r1],2
 0121 5100              mov A,[__r0]
 0123 08                push A
 0124 5100              mov A,[__r1]
 0126 08                push A
 0127 7C0000            xcall _csprintf
 012A                   .dbline 96
 012A           ;                               csprintf(lcdSecondLine,"                ");
 012A 5000              mov A,>L15
 012C 08                push A
 012D 5000              mov A,<L15
 012F 08                push A
 0130 5A00              mov [__r1],X
 0132 060012            add [__r1],18
 0135 5100              mov A,[__r0]
 0137 08                push A
 0138 5100              mov A,[__r1]
 013A 08                push A
 013B 7C0000            xcall _csprintf
 013E 38F8              add SP,-8
 0140                   .dbline 97
 0140           ;               }
 0140           L8:
 0140                   .dbline 100
 0140           ;               
 0140           ;               // lets see what we've got
 0140           ;               LCD_Position(0,0);
 0140 10                push X
 0141 5000              mov A,0
 0143 5700              mov X,0
 0145 7C0000            xcall _LCD_Position
 0148 20                pop X
 0149                   .dbline 101
 0149           ;               LCD_PrString(lcdFirstLine);
 0149 5A00              mov [__r1],X
 014B 060002            add [__r1],2
 014E 10                push X
 014F 5100              mov A,[__r0]
 0151 08                push A
 0152 5100              mov A,[__r1]
 0154 5C                mov X,A
 0155 18                pop A
 0156 7C0000            xcall _LCD_PrString
 0159                   .dbline 102
 0159           ;               LCD_Position(1,0);
 0159 5700              mov X,0
 015B 5001              mov A,1
 015D 7C0000            xcall _LCD_Position
 0160 20                pop X
 0161                   .dbline 103
 0161           ;               LCD_PrString(lcdSecondLine);
 0161 5A00              mov [__r1],X
 0163 060012            add [__r1],18
 0166 10                push X
 0167 5100              mov A,[__r0]
 0169 08                push A
 016A 5100              mov A,[__r1]
 016C 5C                mov X,A
 016D 18                pop A
 016E 7C0000            xcall _LCD_PrString
 0171                   .dbline 106
 0171           ;               
 0171           ;               // lets sleep for a while
 0171           ;               SleepTimer_SyncWait(8, SleepTimer_WAIT_RELOAD);
 0171 5700              mov X,0
 0173 5008              mov A,8
 0175 7C0000            xcall _SleepTimer_SyncWait
 0178 20                pop X
 0179                   .dbline 107
 0179           ;               measuring(temperature, humidity);
 0179 5A00              mov [__r1],X
 017B 06002C            add [__r1],44
 017E 5100              mov A,[__r0]
 0180 08                push A
 0181 5100              mov A,[__r1]
 0183 08                push A
 0184 5A00              mov [__r1],X
 0186 060022            add [__r1],34
 0189 5100              mov A,[__r0]
 018B 08                push A
 018C 5100              mov A,[__r1]
 018E 08                push A
 018F 7C0000            xcall _measuring
 0192 38FC              add SP,-4
 0194                   .dbline 108
 0194           ;       }
 0194           L5:
 0194                   .dbline 64
 0194 8EE5              xjmp L4
 0196           X0:
 0196                   .dbline -2
 0196           L1:
 0196 38CA              add SP,-54
 0198 20                pop X
 0199                   .dbline 0 ; func end
 0199 8FFF              jmp .
 019B                   .dbsym l humidity 44 A[10:5]I
 019B                   .dbsym l temperature 34 A[10:5]I
 019B                   .dbsym l lcdSecondLine 18 A[16:16]c
 019B                   .dbsym l lcdFirstLine 2 A[16:16]c
 019B                   .dbsym l displaymode 0 I
 019B                   .dbend
                        .area lit(rom, con, rel, lit)
 0000           L15:
 0000 20202020202020202020202020202020  .byte 32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32
 0010 00                .byte 0
 0011           L14:
 0011 20202020204572726F72202020202020  .byte 32,32,32,32,32,'E,'r,'r,'o,'r,32,32,32,32,32,32
 0021 00                .byte 0
 0022           L3:
 0022 205765617468657273746174696F6E20  .byte 32,'W,'e,'a,'t,'h,'e,'r,'s,'t,'a,'t,'i,'o,'n,32
 0032 00                .byte 0
 0033           L2:
 0033 20202057656C636F6D6520746F202020  .byte 32,32,32,'W,'e,'l,'c,'o,'m,'e,32,'t,'o,32,32,32
 0043 00                .byte 0
